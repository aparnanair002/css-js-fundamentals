<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bugs & Debugging — Summary</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#60a5fa}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#071022 0%, #071124 60%);color:#e6eef8;padding:24px}
    .wrap{max-width:1000px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:20px}
    p.lead{color:var(--muted);margin:4px 0 20px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:16px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    .section h2{margin:0 0 8px;font-size:16px}
    ul{margin:6px 0 12px 20px;color:var(--muted)}
    details{margin-bottom:10px}
    pre{background:#07122b;padding:12px;border-radius:8px;overflow:auto;color:#cfe8ff}
    code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', monospace}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);color:#04233a;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
    #console{background:#021026;padding:12px;border-radius:8px;height:160px;overflow:auto;color:#a8f0c6;font-family:ui-monospace,monospace}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:16px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#0b1626"/><path d="M6 8h12M6 12h12M6 16h12" stroke="#60a5fa" stroke-width="1.2" stroke-linecap="round"/></svg>
      <div>
        <h1>Bugs & Debugging — Concise summary</h1>
        <p class="lead">A compact, interactive summary of common debugging concepts: strict mode, types, testing, exceptions, error propagation and recommended practices.</p>
      </div>
    </header>

    <div class="grid">
      <main class="card">
        <section class="section">
          <h2>What is a bug?</h2>
          <p class="small">A bug is a flaw in a program — either from confused design (logical/algorithmic) or mistakes translating ideas to code (typos, wrong operators).</p>
          <ul>
            <li>Logical bugs are often harder to diagnose.</li>
            <li>Loosely typed languages (like JS) can hide mistakes (NaN/undefined) until they propagate.</li>
          </ul>
        </section>

        <section class="section">
          <h2>Strict mode</h2>
          <p class="small">"use strict" tightens JavaScript semantics: prevents accidental globals, makes `this` undefined in plain functions, disallows duplicate parameter names, etc.</p>
          <details>
            <summary><strong>Example</strong></summary>
            <pre><code>// without strict: creates global 'counter'
for (counter=0; counter&lt;1; counter++) console.log(counter);

// with strict: ReferenceError if counter not declared
"use strict";
for (counter=0; counter&lt;1; counter++) console.log(counter);
</code></pre>
          </details>
        </section>

        <section class="section">
          <h2>Types & Type discipline</h2>
          <p class="small">Static typing (TypeScript) catches many type errors before runtime. In plain JS, document expected types (comments/JSdoc) or adopt TypeScript for larger codebases.</p>
        </section>

        <section class="section">
          <h2>Testing</h2>
          <p class="small">Automated tests (unit & integration) are the cheapest way to catch regressions. Use test runners and keep tests small, repeatable, and fast.</p>
          <ul>
            <li>Write tests for behavior, not implementation details.</li>
            <li>Prefer pure, side-effect-free code for easier testing.</li>
          </ul>
        </section>

        <section class="section">
          <h2>Debugging</h2>
          <p class="small">Form a hypothesis, make observations (console.log or debugger), test the hypothesis. Avoid random edits — think first.</p>
          <details>
            <summary>Example: numberToString bug</summary>
            <pre><code>// bug: using n /= base produces floats and wrong digits
n = n / base; // wrong
// fix:
n = Math.floor(n / base);
</code></pre>
          </details>
        </section>

        <section class="section">
          <h2>Exceptions & Error handling</h2>
          <p class="small">Use exceptions to signal exceptional situations. Use try/catch to handle expected errors. Finally is for guaranteed cleanup.</p>
          <ul>
            <li>Prefer specific catches: rethrow unexpected exceptions.</li>
            <li>Avoid blanket-catch that hides bugs.</li>
            <li>Use custom Error subclasses to identify error types.</li>
          </ul>
        </section>

        <section class="section">
          <h2>Assertions</h2>
          <p class="small">Assertions detect programmer mistakes early by loudly failing when invariants are violated. Don't over-assert — focus on likely mistakes.</p>
        </section>

        <section class="section">
          <h2>Quick best practices</h2>
          <ul>
            <li>Enable strict mode consistently</li>
            <li>Write tests for critical behavior</li>
            <li>Limit side effects to simplify recovery</li>
            <li>Catch and handle only expected errors</li>
            <li>Use assertions for internal invariants</li>
          </ul>
        </section>

      </main>

      <aside class="card">
        <h2>Interactive exercises</h2>
        <p class="small">Run the canonical solutions for the two exercises from the chapter:</p>

        <div class="controls">
          <button id="runMultiply">Run reliableMultiply(8,8)</button>
          <button id="runBox">Run withBoxUnlocked</button>
          <button class="ghost" id="clear">Clear console</button>
        </div>

        <div style="margin-top:12px">
          <div id="console">Console output will appear here.</div>
        </div>

        <details style="margin-top:12px">
          <summary>Solution notes</summary>
          <p class="small">The implementations below retry only the intended exception type and ensure the box is re-locked even when the body throws.</p>
        </details>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)"/>
        <small class="small">This page summarizes the chapter and provides runnable example solutions. Use it as a quick reference.</small>
      </aside>
    </div>

    <footer class="card">
      <strong>Code examples included below — click the buttons in the right panel to run them.</strong>
      <pre style="margin-top:10px"><code>// Implementations used by the interactive runner (also in page's JS)
class MultiplicatorUnitFailure extends Error {}

function primitiveMultiply(a, b) {
  if (Math.random() &lt; 0.2) return a * b;
  else throw new MultiplicatorUnitFailure('Klunk');
}

// reliableMultiply: retries until it gets a valid result, but only consumes the
// specific MultiplicatorUnitFailure; other exceptions are rethrown.

// withBoxUnlocked: unlocks, runs body, then makes sure the box is locked again.
</code></pre>
    </footer>
  </div>

  <script>
    // page runner helpers
    const out = (s) => {
      const el = document.getElementById('console');
      el.innerText += s + '\n';
      el.scrollTop = el.scrollHeight;
    };
    const clearOut = () => { document.getElementById('console').innerText = ''; };

    // exercise 1: reliableMultiply
    class MultiplicatorUnitFailure extends Error {}
    function primitiveMultiply(a, b) {
      if (Math.random() < 0.2) return a * b;
      else throw new MultiplicatorUnitFailure('Klunk');
    }
    function reliableMultiply(a, b) {
      for (;;) {
        try {
          return primitiveMultiply(a, b);
        } catch (e) {
          if (e instanceof MultiplicatorUnitFailure) {
            // retry
            out('primitiveMultiply failed, retrying...');
            continue;
          } else {
            throw e; // unexpected
          }
        }
      }
    }

    // exercise 2: withBoxUnlocked
    const box = new class {
      locked = true;
      #content = [];
      unlock() { this.locked = false; }
      lock() { this.locked = true; }
      get content() {
        if (this.locked) throw new Error('Locked!');
        return this.#content;
      }
    };

    function withBoxUnlocked(body) {
      const wasLocked = box.locked;
      if (!wasLocked) {
        // already unlocked — just run body
        return body();
      }
      box.unlock();
      try {
        return body();
      } finally {
        // ensure we re-lock only if we unlocked it here
        if (wasLocked) box.lock();
      }
    }

    document.getElementById('runMultiply').addEventListener('click', () => {
      try {
        clearOut();
        out('Calling reliableMultiply(8,8)...');
        const result = reliableMultiply(8,8);
        out('Result: ' + result);
      } catch (e) {
        out('Unexpected error: ' + e);
      }
    });

    document.getElementById('runBox').addEventListener('click', () => {
      try {
        clearOut();
        out('Initial locked: ' + box.locked);
        withBoxUnlocked(() => { box.content.push('gold piece'); out('Pushed gold piece'); });
        out('After push, locked: ' + box.locked);

        try {
          withBoxUnlocked(() => { throw new Error('Pirates on the horizon! Abort!'); });
        } catch (e) {
          out('Caught inside runner: ' + e);
        }
        out('Final locked: ' + box.locked);
      } catch (e) {
        out('Error: ' + e);
      }
    });

    document.getElementById('clear').addEventListener('click', clearOut);
  </script>
</body>
</html>